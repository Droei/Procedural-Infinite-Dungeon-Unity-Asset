RoomSides System Overview (Refactor Notes)

Problem:
The old RoomSides implementation was unreliable because it relied on inconsistent logic. Sides were being spawned and managed from multiple parts of the project, leading to confusion and errors.

Goal:
All side management must happen exclusively through the RoomSidesFactory.
This includes both logic and visualization of room sides. No other system should directly handle sides.

Room and RoomSides Relationship

The only link between Room and RoomSides should occur at room creation:

When a room is created, it is passed to the RoomSidesFactory.

All side data (walls, openings, visuals, etc.) is then handled internally by the RoomSidesFactory.

Room Factory Flow

Shape determination:
The RoomFactory determines the shape and position of a room before sides are considered.

Tracing and generation:
It takes the spawn position, traces around the room to find open adjacent spots, and uses likelihood logic to decide whether new rooms should be generated in those positions.

Room collection:

Rooms are stored in collections (arrays or grouped structures).

Each collection is sent to the RoomSidesFactory for processing.

The RoomSidesFactory handles wall generation:

Outer walls are kept.

Inner (shared) walls between connected rooms are removed.

Spawning Logic

Spawning should be simple and consistent:

Single room:
SpawnRoom(position)
→ Creates a room, sends it to the RoomSidesFactory, and all sides, visuals, and connections are handled automatically.

Room collections (e.g. 2x2 or irregular shapes):
SpawnRoomCollection(roomArray)
→ Spawns multiple rooms as a connected structure.
→ The RoomSidesFactory automatically removes internal walls and keeps only the outer walls.

(Optionally, walls can store their own vec2 positions or identifiers for easy detection and removal.)

Random Room Shapes

When generating random room chains or shapes:

The RoomFactory determines where connected rooms should appear.

It then sends the resulting array of rooms to the RoomSidesFactory.

The RoomSidesFactory finalizes the wall setup, filling in correct outer walls and removing internal ones.